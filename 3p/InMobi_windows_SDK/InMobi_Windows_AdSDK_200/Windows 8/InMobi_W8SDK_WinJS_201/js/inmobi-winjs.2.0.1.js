(function(WinJS){WinJS.Namespace.define("InMobi",{_version:null,_adServerURL:"http://i.w.inmobi.com/showad.asm",_adServerTestURL:"http://t.sandbox.inmobi.com/showad.asm",listenerCacheUrl:"http://cf.cdn.inmobi.com/ad/inmobi-winjslisteners.2.0.1.js",_versionString:"pr-JSWP-CTATB-20130606",_configParamsRequired:["adsize","siteid"],_configParamsAccepted:{siteid:"mk-siteid",slot:"mk-site-slotid",adsize:"mk-ad-slot",age:"u-age",gender:"u-gender",location:"u-location",interests:"u-interests",postalCode:"u-postalCode",areaCode:"u-areaCode",dateOfBirth:"u-dateOfBirth",income:"u-income",latlong:"u-latlong",education:"u-education",ethnicity:"u-ethnicity",adtype:"adtype",targetwindow:"targetWindow",testdeviceid:"d_tdid"},_slotSizes:{"1":{width:120,height:20},"2":{width:168,height:28},"3":{width:216,height:36},"4":{width:300,height:50},"9":{width:320,height:48},"10":{width:300,height:250},"11":{width:728,height:90},"12":{width:468,height:60},"13":{width:120,height:600},"14":{width:320,height:480},"15":{width:320,height:50},"16":{width:1024,height:768},"17":{width:1280,height:800},"27":{width:500,height:130},"28":{width:292,height:60},"29":{width:250,height:250},"30":{width:250,height:125},"31":{width:320,height:568}},_maxSize:function(){var maxW=window.innerWidth,maxH=window.innerHeight,lastC=null,slot;for(slot in this._slotSizes){if(this._slotSizes[slot].height<=maxH&&this._slotSizes[slot].width<=maxW){if(lastC==null||this._slotSizes[lastC].width<this._slotSizes[slot].width){lastC=slot}}}return lastC},_getSlotSize:function(config){return this._slotSizes[""+config.adsize]},_validateConfig:function(config){var i,k;if(config===null){throw"Expected config object, got null, make sure inmobi_conf variable is set for each ad slot."}if(typeof config!=="object"){throw"Expected config object, got "+(typeof config)+" make sure inmobi_conf variable is set for each ad slot."}for(i=0;i<this._configParamsRequired.length;i++){k=this._configParamsRequired[i].toLowerCase();if(!config.hasOwnProperty(k)||config[k]===null||config[k].length===0){throw"inmobi.js: ERROR: missing required config parameter '"+k+"'"}}if(!this._slotSizes[""+config.adsize]){throw"inmobi.js: ERROR: inmobi config adsize param, '"+config.adsize+"', is not a valid adsize."}},_randomString:function(){var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i;for(i=0;i<6;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length))}return text},_confToString:function(config){this._validateConfig(config);var qry=[],k;for(k in config){k=k.toLowerCase();if(this._configParamsAccepted.hasOwnProperty(k)){qry.push(encodeURIComponent(this._configParamsAccepted[k])+"="+encodeURIComponent(config[k]))}}qry.push("mk-ads=1");qry.push("mk-version="+encodeURIComponent(this._versionString));qry.push("format=html");qry.push("__t="+(new Date()).getTime()+"-"+this._randomString());return qry.join("&")},_getURL:function(config){var base=config.test?this._adServerTestURL:this._adServerURL;return base+(base.indexOf("?")===-1?"?":"&")+this._confToString(config)},_parseJSON:function(j){if(typeof(j)=="object"){return j}if(JSON){return JSON.parse(j)}else{return this.globalEval("("+j+")")}},_ads:[],_iframeToAd:function(iframe){var ads=InMobi._ads,ad=null,i;for(i=0;i<ads.length;i++){if(ads[i]._iframeRef===iframe){ad=ads[i];break}}return ad},IMAdView:WinJS.Class.define(function(element,options){this._element=element;this._element.winControl=this;this._createControl()},{_element:null,_adRefreshInterval:20,_events:["close"],_testSiteId:"4028cba631d63df10131e1d3191d00cb",_conf:null,_refreshTimer:null,_state:"default",_defaultRefreshInterval:60,_iframeRef:null,_eventListeners:{loaded:[],error:[],stateChange:[]},_isInterstitial:false,_setState:function(state1){if(typeof state1=="string"){this._state=state1;this._fireEvent("stateChange",{state:state1})}},_postToContainer:function(container,arg0,arg1){container.postMessage({action:arg0,data:arg1,inmobiMessage:true},"*")},_dispatchEvent:function(type,arg){var i;if(this.events.indexOf(type)==-1){throw"inmobi.js: ERROR: Unknown event type '"+type+"'"}if(!this.listeners[type]){return}for(i=0;i<this.listeners[type].length;i++){(this.listeners[type][i])(arg)}},_createControl:function(){this._element.innerHTML="";var iframe=document.createElement("iframe"),interval,pseudoThis=this;this._iframeRef=iframe;iframe.setAttribute("height","0px");this._element.appendChild(iframe);InMobi._ads.push(this);iframe.onload=function(event){if(event.target.src!=""){InMobi.IMAdView.adLoaded(event.target)}};try{this._conf=eval("("+this._element.getAttribute("data-win-options")+")")}catch(e){console.log("InMobi: data-win-options is malformed. Please refer integration guidelines for more information.");this._conf={}}if(typeof this._conf!="object"||this._conf==null){this._conf={}}this.addEventListener("error",function(ad,event){eval(pseudoThis._element.getAttribute("onError"))});if(typeof this._conf.onload=="function"){this._conf.onload(this)}if(typeof this._conf.manual!="boolean"||!this._conf.manual){try{this.getNewAd()}catch(e){console.log("InMobi: "+e)}}try{interval=this._conf.autorefresh-0;if(isNaN(interval)){this.setAdRefreshInterval(this._defaultRefreshInterval)}else{try{this.setAdRefreshInterval(interval)}catch(e){console.log("InMobi: "+e)}}}catch(e){}},_loadAd:function(){if(this._state=="expanded"){return}this._state="default";var iframe=this._iframeRef,slotSize=InMobi._getSlotSize(this._conf),url;iframe.src="";if(typeof(slotSize)!="undefined"){iframe.setAttribute("width",slotSize.width+"px");iframe.setAttribute("height",slotSize.height+"px");url=InMobi._getURL(this._conf);iframe.src=url}else{throw"Check adSize parameter and provide a correct value."}},getNewAd:function(conf){if(typeof conf!="undefined"){this._conf=conf}try{this._loadAd()}catch(e){throw e}},setAdRefreshInterval:function(adRefreshInterval){adRefreshInterval=adRefreshInterval-0;if(isNaN(adRefreshInterval)){throw"Ad refresh interval must be a number"}if(adRefreshInterval<20){throw"Ad refresh interval must be atleast 20 seconds."}window.clearInterval(this._refreshTimer);this._adRefreshInterval=adRefreshInterval;this._refreshTimer=window.setInterval(function(obj){obj.getNewAd()},adRefreshInterval*1000,this)},clearAdRefreshInterval:function(adRefreshInterval){window.clearInterval(this._refreshTimer);this._adRefreshInterval=Number.POSITIVE_INFINITY},setConfig:function(conf){if(typeof conf!="undefined"){this._conf=conf}},_fireEvent:function(event,data){if(typeof event!="string"){return}if(typeof this._eventListeners[event]!="undefined"){for(var fn in this._eventListeners[event]){try{this._eventListeners[event][fn](this,data)}catch(e){}}}},addEventListener:function(event,callBack){if(typeof event!="string"){throw"Event must be a string"}if(typeof callBack!="function"){throw"Callback must be a function"}if(typeof this._eventListeners[event]!="undefined"){this._eventListeners[event].push(callBack)}else{throw"Event not supported: "+event}}},{adLoaded:function(iframe){var ad=InMobi._iframeToAd(iframe);if(ad!=null){ad._fireEvent("loaded",{})}}}),IMAdInterstitial:WinJS.Class.define(function(appId,conf){this._createControl(appId,conf)},{_element:null,_adRefreshInterval:20,_events:["close"],_testSiteId:"4028cba631d63df10131e1d3191d00cb",_conf:null,_refreshTimer:null,_state:"default",_defaultRefreshInterval:60,_iframeRef:null,_eventListeners:{loaded:[],error:[],stateChange:[]},_setState:function(state1){if(typeof state1=="string"){this._state=state1;this._fireEvent("stateChange",{state:state1})}},_postToContainer:function(container,arg0,arg1){container.postMessage({action:arg0,data:arg1,inmobiMessage:true},"*")},_dispatchEvent:function(type,arg){var i;if(this.events.indexOf(type)==-1){throw"inmobi.js: ERROR: Unknown event type '"+type+"'"}if(!this.listeners[type]){return}for(i=0;i<this.listeners[type].length;i++){(this.listeners[type][i])(arg)}},_isInterstitial:true,_createControl:function(conf){this._conf=conf;this._state="init";var iframe=document.createElement("iframe"),div=document.createElement("div"),cell=document.createElement("div"),ad;this._iframeRef=iframe;cell.appendChild(iframe);div.appendChild(cell);div.style.backgroundColor="black";div.style.width="100%";div.style.height="100%";div.style.position="absolute";div.style.left="0px";div.style.top="0px";div.style.zIndex="2147483647";div.style.verticalAlign="middle";div.style.textAlign="center";div.style.display="none";div.onclick=function(){ad=InMobi._iframeToAd(this.getElementsByTagName("iframe")[0]);ad.hideAd()};cell.style.display="table-cell";cell.style.verticalAlign="middle";document.body.appendChild(div);InMobi._ads.push(this);iframe.addEventListener("load",function(event){if(event.target.src!=""){InMobi.IMAdInterstitial.adLoaded(event.target)}});iframe.setAttribute("width",(document.body.clientWidth-88)+"px");iframe.setAttribute("height",(document.body.clientHeight-88)+"px");if(typeof conf.manual=="undefined"){this.getNewAd()}this.addEventListener("error",function(ad,val){if(val.message=="nfr"){ad._state="active";ad.hideAd()}})},_loadAd:function(){if(this._state=="active"){return}this._setState("loading");var iframe=this._iframeRef,slotSize,url;iframe.src="";this._conf.adsize="16";slotSize=InMobi._getSlotSize(this._conf);url=InMobi._getURL(this._conf);iframe.src=url},getNewAd:function(conf){if(typeof conf!="undefined"){this._conf=conf}try{this._loadAd()}catch(e){throw e}},setConfig:function(conf){if(typeof conf!="undefined"){this._conf=conf}},getState:function(){return this._state},_fireEvent:function(event,data){if(typeof event!="string"){return}if(typeof this._eventListeners[event]!="undefined"){for(var fn in this._eventListeners[event]){try{this._eventListeners[event][fn](this,data)}catch(e){}}}},addEventListener:function(event,callBack){if(typeof event!="string"){throw"Event must be a string"}if(typeof callBack!="function"){throw"Callback must be a function"}if(typeof this._eventListeners[event]!="undefined"){this._eventListeners[event].push(callBack)}else{throw"Event not supported: "+event}},showAd:function(){if(this._state=="active"){this._fireEvent("error","Interstitial already displayed.")}else{if(this._state=="loading"||this._state=="init"){this._fireEvent("error","Interstitial is in "+this._state+" state. Cannot display the ad.")}else{if(this._state=="ready"){this._iframeRef.parentNode.parentNode.style.display="table";this._setState("active")}}}},hideAd:function(){if(this._state=="ready"){this._fireEvent("error","Interstitial not yet displayed.")}else{if(this._state=="default"){this._fireEvent("error","Interstitial not loaded yet.")}else{if(this._state=="init"){this._fireEvent("error","Interstitial is in init state. Cannot hide ad.")}else{if(this._state=="active"){this._iframeRef.parentNode.parentNode.style.display="none";this._setState("init")}}}}}},{adLoaded:function(iframe){var ad=InMobi._iframeToAd(iframe);if(ad!=null){ad._setState("ready");ad._fireEvent("loaded",{})}}}),_getCacheFailIntervalScale:1000,_getCacheTries:0,_getCacheTriesSaturation:12,cacheBootstrap:function(){var storage=window.localStorage.getItem("inmobi.windowListener"),xmlhttp;if(storage==null){xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",InMobi.listenerCacheUrl+"?"+(new Date().getTime()),false);xmlhttp.send();if(xmlhttp.status==200){storage=xmlhttp.responseText;window.localStorage.setItem("inmobi.windowListener",storage)}else{if(this._getCacheTries<this._getCacheTriesSaturation){this._getCacheTries++}window.setTimeout(this.cacheBootstrap,this._getCacheFailIntervalScale*Math.pow(2,this._getCacheTries));return}}this._getCacheTries=0;window.removeEventListener("message",InMobi.listenerFunction);eval(storage);window.addEventListener("message",InMobi.listenerFunction)},clearCache:function(){window.localStorage.removeItem("inmobi.windowListener")},isVersionGreater:function(version){var splitNewVersion=version.split("."),splitCurrentVersion,i;if(this._version!=null){splitCurrentVersion=this._version.split(".")}else{splitCurrentVersion=[-1]}for(i=0;i<splitCurrentVersion.length||i<splitNewVersion.length;i++){if(i>=splitCurrentVersion.length||isNaN(splitCurrentVersion[i]-0)){splitCurrentVersion[i]=0}if(i>=splitNewVersion.length||isNaN(splitNewVersion[i]-0)){splitNewVersion[i]=0}if(Number(splitNewVersion[i])>Number(splitCurrentVersion[i])){return true}}return false}})}(WinJS));window.addEventListener("message",function(e){var c=InMobi._ads,d=null,b,f,a;for(b=0;b<c.length;b++){if(c[b]._iframeRef.contentWindow===e.source){a=c[b]._iframeRef.contentWindow;d=c[b];break}}if(d!=null){f=InMobi._parseJSON(e.data);if(f.action!=undefined){d._mraidStatus=f.action}if(typeof f.action!="undefined"){switch(f.action){case"requireVersion":if(InMobi.isVersionGreater(f.data)){InMobi.clearCache();InMobi.cacheBootstrap()}break;case"error":d._fireEvent("error",{message:f.data.message});break;case"log":console.log(f.data);break;default:if(InMobi._version==null){d._postToContainer(a,"fireEvent",{event:"error",eventData:"IMRAID bridge not initialized"})}}}if(typeof f.topic!="undefined"){switch(f.topic){case"nfr":d._fireEvent("error",{message:"nfr"});break}}}});window.setTimeout(function(){InMobi.cacheBootstrap();console.log("Using : "+InMobi._version)},0);